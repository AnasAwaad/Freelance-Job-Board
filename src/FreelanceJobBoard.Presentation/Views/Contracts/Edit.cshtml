@model FreelanceJobBoard.Presentation.Models.ViewModels.ProposeContractChangeViewModel
@{
    ViewData["Title"] = "Propose Contract Changes";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="d-flex flex-column flex-column-fluid">
    <!--begin::Toolbar-->
    <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
        <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
            <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Propose Contract Changes</h1>
                <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                    <li class="breadcrumb-item text-muted">
                        <a asp-controller="Home" asp-action="Index" class="text-muted text-hover-primary">Home</a>
                    </li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">
                        <a asp-action="Index" class="text-muted text-hover-primary">Contracts</a>
                    </li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">
                        <a asp-action="Details" asp-route-id="@Model.ContractId" class="text-muted text-hover-primary">Contract #@Model.ContractId</a>
                    </li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">Propose Changes</li>
                </ul>
            </div>
            <div class="d-flex align-items-center gap-2 gap-lg-3">
                <a asp-action="Details" asp-route-id="@Model.ContractId" class="btn btn-sm fw-bold btn-secondary">
                    <i class="ki-duotone ki-arrow-left fs-4"></i>
                    Back to Contract
                </a>
            </div>
        </div>
    </div>
    <!--end::Toolbar-->

    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-xxl">
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="ki-duotone ki-cross-circle fs-2 me-3">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>
                    @TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <div class="row">
                <div class="col-xl-8 offset-xl-2">
                    <!-- Information Alert -->
                    <div class="alert alert-primary d-flex align-items-center p-5 mb-10">
                        <i class="ki-duotone ki-shield-tick fs-2hx text-primary me-4">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                        <div class="d-flex flex-column">
                            <h4 class="mb-1 text-dark">Contract Change Proposal</h4>
                            <span>Propose modifications to the contract terms. The other party will be notified and can approve or reject your changes. All changes are tracked in the contract history.</span>
                        </div>
                    </div>

                    <!-- Contract Edit Form -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title fs-3 fw-bold">Contract Details</div>
                        </div>
                        <form asp-action="Edit" method="post" enctype="multipart/form-data" novalidate>
                            <input asp-for="ContractId" type="hidden" />
                            
                            <div class="card-body">
                                <!-- Contract Title -->
                                <div class="fv-row mb-8">
                                    <label asp-for="Title" class="required fs-6 fw-semibold mb-2">Contract Title</label>
                                    <input asp-for="Title" type="text" class="form-control form-control-solid" placeholder="Enter contract title" />
                                    <span asp-validation-for="Title" class="text-danger"></span>
                                </div>

                                <!-- Contract Description -->
                                <div class="fv-row mb-8">
                                    <label asp-for="Description" class="required fs-6 fw-semibold mb-2">Project Description</label>
                                    <textarea asp-for="Description" class="form-control form-control-solid" rows="4" placeholder="Describe the project scope and requirements"></textarea>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                </div>

                                <!-- Payment Information -->
                                <div class="row">
                                    <div class="col-xl-6">
                                        <div class="fv-row mb-8">
                                            <label asp-for="PaymentAmount" class="required fs-6 fw-semibold mb-2">Payment Amount ($)</label>
                                            <input asp-for="PaymentAmount" type="number" step="0.01" min="0" class="form-control form-control-solid" placeholder="0.00" />
                                            <span asp-validation-for="PaymentAmount" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="fv-row mb-8">
                                            <label asp-for="PaymentType" class="required fs-6 fw-semibold mb-2">Payment Type</label>
                                            <select asp-for="PaymentType" class="form-select form-select-solid">
                                                <option value="">Select payment type</option>
                                                <option value="Fixed">Fixed Price</option>
                                                <option value="Hourly">Hourly Rate</option>
                                                <option value="Milestone">Milestone-based</option>
                                            </select>
                                            <span asp-validation-for="PaymentType" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Project Deadline -->
                                <div class="fv-row mb-8">
                                    <label asp-for="ProjectDeadline" class="fs-6 fw-semibold mb-2">Project Deadline (Optional)</label>
                                    <input asp-for="ProjectDeadline" type="datetime-local" class="form-control form-control-solid" />
                                    <span asp-validation-for="ProjectDeadline" class="text-danger"></span>
                                    <div class="form-text">Set a specific deadline for project completion</div>
                                </div>

                                <!-- Deliverables -->
                                <div class="fv-row mb-8">
                                    <label asp-for="Deliverables" class="fs-6 fw-semibold mb-2">Deliverables</label>
                                    <textarea asp-for="Deliverables" class="form-control form-control-solid" rows="3" placeholder="List the expected deliverables and milestones"></textarea>
                                    <span asp-validation-for="Deliverables" class="text-danger"></span>
                                </div>

                                <!-- Terms and Conditions -->
                                <div class="fv-row mb-8">
                                    <label asp-for="TermsAndConditions" class="fs-6 fw-semibold mb-2">Terms and Conditions</label>
                                    <textarea asp-for="TermsAndConditions" class="form-control form-control-solid" rows="4" placeholder="Specify any special terms, conditions, or requirements"></textarea>
                                    <span asp-validation-for="TermsAndConditions" class="text-danger"></span>
                                </div>

                                <!-- Additional Notes -->
                                <div class="fv-row mb-8">
                                    <label asp-for="AdditionalNotes" class="fs-6 fw-semibold mb-2">Additional Notes</label>
                                    <textarea asp-for="AdditionalNotes" class="form-control form-control-solid" rows="3" placeholder="Any additional information or special requests"></textarea>
                                    <span asp-validation-for="AdditionalNotes" class="text-danger"></span>
                                </div>

                                <!-- Contract Documents -->
                                <div class="fv-row mb-8">
                                    <label asp-for="AttachmentFiles" class="fs-6 fw-semibold mb-2">Contract Documents (Optional)</label>
                                    <input asp-for="AttachmentFiles" type="file" class="form-control form-control-solid" multiple 
                                           accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" />
                                    <span asp-validation-for="AttachmentFiles" class="text-danger"></span>
                                    <div class="form-text">
                                        Upload supporting documents for your contract changes (PDF, DOC, DOCX, JPG, PNG - Max 10MB each)
                                    </div>
                                </div>

                                <!-- Change Reason (Required) -->
                                <div class="fv-row mb-8">
                                    <label asp-for="ChangeReason" class="required fs-6 fw-semibold mb-2">Reason for Changes</label>
                                    <textarea asp-for="ChangeReason" class="form-control form-control-solid" rows="3" placeholder="Explain why you are proposing these changes to the contract"></textarea>
                                    <span asp-validation-for="ChangeReason" class="text-danger"></span>
                                    <div class="form-text">This will be visible to the other party when they review your proposal</div>
                                </div>

                                <!-- File Upload Tips -->
                                <div class="alert alert-info">
                                    <h4 class="alert-heading">
                                        <i class="ki-duotone ki-information-5 fs-2">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                            <span class="path3"></span>
                                        </i>
                                        Document Guidelines:
                                    </h4>
                                    <ul class="mb-0">
                                        <li>Attach any relevant documents that support your proposed changes</li>
                                        <li>Include updated specifications, mockups, or reference materials</li>
                                        <li>Ensure documents are clear and professionally formatted</li>
                                        <li>Maximum file size: 10MB per file</li>
                                        <li>Supported formats: PDF, DOC, DOCX, JPG, PNG, GIF</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card-footer d-flex justify-content-end py-6 px-9">
                                <a asp-action="Details" asp-route-id="@Model.ContractId" class="btn btn-light btn-active-light-primary me-2">
                                    Cancel
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <span class="indicator-label">
                                        <i class="ki-duotone ki-check fs-2"></i>
                                        Submit Changes
                                    </span>
                                    <span class="indicator-progress">
                                        Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const submitButton = form.querySelector('button[type="submit"]');
            const fileInput = document.querySelector('input[type="file"]');
            
            // File upload validation
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    const files = this.files;
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    const allowedTypes = [
                        'application/pdf',
                        'application/msword',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'image/jpeg',
                        'image/jpg',
                        'image/png',
                        'image/gif'
                    ];
                    
                    for (let file of files) {
                        if (file.size > maxSize) {
                            alert(`File "${file.name}" is too large. Maximum size is 10MB.`);
                            this.value = '';
                            break;
                        }
                        
                        if (!allowedTypes.includes(file.type)) {
                            alert(`File "${file.name}" has an unsupported format. Please use PDF, DOC, DOCX, JPG, PNG, or GIF.`);
                            this.value = '';
                            break;
                        }
                    }
                });
            }
            
            form.addEventListener('submit', function(e) {
                // Add loading state
                submitButton.setAttribute('data-kt-indicator', 'on');
                submitButton.disabled = true;
            });
        });
    </script>
}